<!-- Table of Contents Generator -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const content = document.querySelector('.exercise-content');
  if (!content) return;

  const headings = content.querySelectorAll('h2, h3');
  if (headings.length < 3) return; // Only show TOC if there are enough headings

  // Create TOC container
  const tocContainer = document.createElement('aside');
  tocContainer.className = 'toc-sidebar';
  tocContainer.innerHTML = '<div class="toc-header">On this page</div><nav class="toc-nav"></nav>';

  const tocNav = tocContainer.querySelector('.toc-nav');
  const tocList = document.createElement('ul');
  tocList.className = 'toc-list';

  // Build TOC
  headings.forEach((heading, index) => {
    // Add ID if missing
    if (!heading.id) {
      heading.id = 'heading-' + index;
    }

    const li = document.createElement('li');
    li.className = 'toc-item toc-' + heading.tagName.toLowerCase();

    const link = document.createElement('a');
    link.href = '#' + heading.id;
    link.textContent = heading.textContent;
    link.className = 'toc-link';

    // Smooth scroll
    link.addEventListener('click', function(e) {
      e.preventDefault();
      heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
      history.pushState(null, null, '#' + heading.id);
    });

    li.appendChild(link);
    tocList.appendChild(li);
  });

  tocNav.appendChild(tocList);

  // Insert TOC
  const exerciseArticle = document.querySelector('.exercise');
  if (exerciseArticle) {
    exerciseArticle.insertBefore(tocContainer, exerciseArticle.firstChild);
  }

  // Highlight active section
  const observerOptions = {
    rootMargin: '-20% 0px -70% 0px',
    threshold: 0
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const id = entry.target.id;
      const tocLink = document.querySelector(`.toc-link[href="#${id}"]`);
      if (tocLink) {
        if (entry.isIntersecting) {
          document.querySelectorAll('.toc-link.active').forEach(link => {
            link.classList.remove('active');
          });
          tocLink.classList.add('active');
        }
      }
    });
  }, observerOptions);

  headings.forEach(heading => observer.observe(heading));

  // Make TOC sticky after header
  const header = document.querySelector('.site-header');
  if (header) {
    const headerHeight = header.offsetHeight;
    tocContainer.style.top = (headerHeight + 20) + 'px';
  }
});
</script>

<!-- Scroll to Top Button -->
<button id="scroll-to-top" aria-label="Scroll to top">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M12 19V5M5 12l7-7 7 7"/>
  </svg>
</button>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const scrollButton = document.getElementById('scroll-to-top');
  if (!scrollButton) return;

  // Show/hide based on scroll position
  window.addEventListener('scroll', () => {
    if (window.scrollY > 500) {
      scrollButton.classList.add('visible');
    } else {
      scrollButton.classList.remove('visible');
    }
  });

  // Scroll to top on click
  scrollButton.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
});
</script>

<!-- Reading Progress Bar -->
<div class="reading-progress" aria-hidden="true"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const progressBar = document.querySelector('.reading-progress');
  if (!progressBar) return;

  window.addEventListener('scroll', () => {
    const windowHeight = window.innerHeight;
    const documentHeight = document.documentElement.scrollHeight;
    const scrollTop = window.scrollY;
    const progress = (scrollTop / (documentHeight - windowHeight)) * 100;
    progressBar.style.width = progress + '%';
  });
});
</script>
